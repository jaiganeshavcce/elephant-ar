<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elephant AR Experience</title>
    
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>
    
    <style>
        body { margin: 0; background-color: #f0f2f5; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; }
        
        /* The 3D Viewer */
        model-viewer {
            width: 100%;
            height: 100vh;
            background-color: #ffffff;
            z-index: 1;
        }

        /* --- TOP RIGHT AR BUTTON --- */
        .ar-button {
            background-color: #007bff;
            color: white;
            border-radius: 50px;
            border: none;
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0,123,255,0.4);
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        
        .ar-button:active { transform: scale(0.95); }
        .ar-button svg { fill: white; width: 18px; height: 18px; }

        /* --- BOTTOM CONTROL BAR --- */
        .controls {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            background: rgba(255, 255, 255, 0.95);
            padding: 12px 25px;
            border-radius: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            backdrop-filter: blur(5px);
            z-index: 100;
            align-items: center;
        }

        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 12px;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #555;
            font-size: 11px;
            min-width: 50px;
        }

        .icon-btn:active { background-color: #e0e0e0; transform: scale(0.9); }
        .icon-btn svg { width: 24px; height: 24px; fill: #444; margin-bottom: 4px; }
        
        /* Highlight the Feed Button */
        .feed-btn svg { fill: #f1c40f; } 
        .feed-btn { color: #d4ac0d; font-weight: bold; }

        /* --- FALLING FOOD ANIMATION --- */
        .falling-food {
            position: absolute;
            top: -60px; /* Start above screen */
            font-size: 45px; /* Big Emoji Size */
            z-index: 1000; /* On top of EVERYTHING */
            pointer-events: none; /* Let clicks pass through */
            /* Animation defined in JS now for randomness */
        }

        @keyframes fall-straight {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(90vh) rotate(360deg); opacity: 0; }
        }

        @keyframes fall-wobble {
            0% { transform: translateY(0) rotate(0deg) translateX(0); opacity: 1; }
            50% { transform: translateY(45vh) rotate(180deg) translateX(20px); opacity: 1; }
            100% { transform: translateY(90vh) rotate(360deg) translateX(-20px); opacity: 0; }
        }

        #error-message {
            position: absolute; top: 80px; left: 50%; transform: translateX(-50%);
            background-color: #ffebee; color: #c62828; padding: 10px 20px;
            border-radius: 8px; font-size: 14px; display: none; width: 80%; text-align: center; z-index: 99;
        }
    </style>
</head>
<body>

    <div id="error-message">Checking AR compatibility...</div>

    <audio id="audio-walk" src="walk.mp3"></audio>
    <audio id="audio-trumpet" src="trumpet.mp3"></audio>

    <model-viewer 
        id="viewer"
        src="elephant.glb" 
        alt="A 3D model of an elephant" 
        ar 
        ar-modes="webxr scene-viewer quick-look" 
        camera-controls 
        auto-rotate 
        autoplay
        shadow-intensity="1"
        ar-scale="auto"
        ar-placement="floor">
        
        <button slot="ar-button" id="ar-btn" class="ar-button">
            <svg viewBox="0 0 24 24"><path d="M21 16.5l-9-5-9 5v-11l9-5 9 5v11zm-9-13.5l-7.5 4.2v8.8l7.5 4.2 7.5-4.2v-8.8l-7.5-4.2z"/></svg>
            View in Room
        </button>
        
    </model-viewer>

    <div class="controls">
        <button class="icon-btn" onclick="toggleAnimation()">
            <svg id="play-icon" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
            <span>Walk</span>
        </button>
        
        <button class="icon-btn" onclick="playTrumpet()">
            <svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
            <span>Sound</span>
        </button>

        <button class="icon-btn feed-btn" onclick="feedElephant()">
            <svg viewBox="0 0 24 24"><path d="M20.2 17.6l-2.8-7.8c-.4-1.1-1.3-1.9-2.4-2.1-.2 0-.3-.1-.5-.1s-.4 0-.6.1c-1.1.2-2 1.1-2.4 2.1L8.8 17.6c-.3.8.3 1.6 1.1 1.6h1.5c.6 0 1.1-.3 1.4-.8l.7-1.4h4.1l.7 1.4c.3.5.8.8 1.4.8h1.5c.8 0 1.4-.9 1-1.6z"/></svg>
            <span>Feed</span>
        </button>

        <button class="icon-btn" onclick="resetView()">
            <svg viewBox="0 0 24 24"><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/></svg>
            <span>Reset</span>
        </button>
    </div>

    <script>
        const viewer = document.querySelector('#viewer');
        const errorMsg = document.querySelector('#error-message');
        const arBtn = document.querySelector('#ar-btn');
        const playIcon = document.querySelector('#play-icon');
        const audioWalk = document.getElementById('audio-walk');
        const audioTrumpet = document.getElementById('audio-trumpet');
        
        // Audio Setup
        audioWalk.loop = true;
        audioWalk.volume = 0.5;

        // AR SUPPORT CHECK
        viewer.addEventListener('load', () => {
            if (viewer.canActivateAR) {
                errorMsg.style.display = 'none';
                arBtn.style.display = 'flex';
                // Try auto-play
                if (!viewer.paused) {
                    audioWalk.play().catch(e => console.log("Waiting for user interaction"));
                }
            } else {
                errorMsg.innerText = "‚ö†Ô∏è AR not supported on this device/browser.";
                errorMsg.style.display = 'block';
                arBtn.style.display = 'none';
            }
        });

        // --- INTERACTIVE FUNCTIONS ---

        function toggleAnimation() {
            if (viewer.paused) {
                viewer.play();
                audioWalk.play();
                playIcon.innerHTML = '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>'; 
            } else {
                viewer.pause();
                audioWalk.pause();
                playIcon.innerHTML = '<path d="M8 5v14l11-7z"/>'; 
            }
        }

        function playTrumpet() {
            audioTrumpet.currentTime = 0;
            audioTrumpet.play();
        }

        // FOOD MENU
        const foodMenu = ['üçå', 'üçé', 'üçâ', 'üåΩ', 'ü•¨', 'ü•ú'];

        function feedElephant() {
            // Drop 10 items for a feast
            for (let i = 0; i < 10; i++) {
                // Random delay between 0 and 1500ms
                setTimeout(() => createFood(), Math.random() * 1500);
            }
        }

        function createFood() {
            const food = document.createElement('div');
            food.classList.add('falling-food');
            
            // 1. Pick Random Food
            const randomItem = foodMenu[Math.floor(Math.random() * foodMenu.length)];
            food.innerText = randomItem;
            
            // 2. Random Horizontal Position (10% to 90%)
            const randomLeft = Math.random() * 80 + 10; 
            food.style.left = randomLeft + '%';

            // 3. Random Animation (Straight or Wobble)
            const animType = Math.random() > 0.5 ? 'fall-straight' : 'fall-wobble';
            food.style.animation = `${animType} 2s ease-in forwards`;
            
            document.body.appendChild(food);

            // Cleanup
            setTimeout(() => {
                food.remove();
            }, 2000);
        }

        function resetView() {
            viewer.cameraOrbit = "0deg 75deg 105%";
            viewer.jumpCameraToGoal();
        }
    </script>

</body>
</html>